<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Pandas Cookbook 2ed | Sangwon’s Daily Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Pandas Cookbook 2ed" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="매트 해리슨, 시어도어 페트로우 지음, 크라스랩 옮김" />
<meta property="og:description" content="매트 해리슨, 시어도어 페트로우 지음, 크라스랩 옮김" />
<link rel="canonical" href="https://sangwon-woo.github.io/dailyblog/markdown/database/dbms/mysql/datatype/2021/11/05/post020.html" />
<meta property="og:url" content="https://sangwon-woo.github.io/dailyblog/markdown/database/dbms/mysql/datatype/2021/11/05/post020.html" />
<meta property="og:site_name" content="Sangwon’s Daily Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-05T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://sangwon-woo.github.io/dailyblog/markdown/database/dbms/mysql/datatype/2021/11/05/post020.html","@type":"BlogPosting","headline":"Pandas Cookbook 2ed","dateModified":"2021-11-05T00:00:00-05:00","datePublished":"2021-11-05T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://sangwon-woo.github.io/dailyblog/markdown/database/dbms/mysql/datatype/2021/11/05/post020.html"},"description":"매트 해리슨, 시어도어 페트로우 지음, 크라스랩 옮김","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/dailyblog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://sangwon-woo.github.io/dailyblog/feed.xml" title="Sangwon's Daily Blog" /><link rel="shortcut icon" type="image/x-icon" href="/dailyblog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/dailyblog/">Sangwon&#39;s Daily Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/dailyblog/about/">About Me</a><a class="page-link" href="/dailyblog/gitInfo/">Github</a><a class="page-link" href="/dailyblog/search/">Search</a><a class="page-link" href="/dailyblog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Pandas Cookbook 2ed</h1><p class="page-description">매트 해리슨, 시어도어 페트로우 지음, 크라스랩 옮김</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-11-05T00:00:00-05:00" itemprop="datePublished">
        Nov 5, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      24 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/dailyblog/categories/#markdown">markdown</a>
        &nbsp;
      
        <a class="category-tags-link" href="/dailyblog/categories/#database">database</a>
        &nbsp;
      
        <a class="category-tags-link" href="/dailyblog/categories/#dbms">dbms</a>
        &nbsp;
      
        <a class="category-tags-link" href="/dailyblog/categories/#mysql">mysql</a>
        &nbsp;
      
        <a class="category-tags-link" href="/dailyblog/categories/#datatype">datatype</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#1장-판다스-기초">1장 판다스 기초</a>
<ul>
<li class="toc-entry toc-h2"><a href="#판다스-임포트">판다스 임포트</a></li>
<li class="toc-entry toc-h2"><a href="#판다스-데이터프레임-해부하기">판다스 데이터프레임 해부하기</a></li>
<li class="toc-entry toc-h2"><a href="#데이터프레임-속성">데이터프레임 속성</a></li>
<li class="toc-entry toc-h2"><a href="#데이터-형식-이해">데이터 형식 이해</a></li>
<li class="toc-entry toc-h2"><a href="#열-선택">열 선택</a></li>
<li class="toc-entry toc-h2"><a href="#시리즈-메서드-호출">시리즈 메서드 호출</a></li>
<li class="toc-entry toc-h2"><a href="#시리즈-연산">시리즈 연산</a></li>
<li class="toc-entry toc-h2"><a href="#시리즈-메서드-체인">시리즈 메서드 체인</a></li>
<li class="toc-entry toc-h2"><a href="#열-이름-변경">열 이름 변경</a></li>
<li class="toc-entry toc-h2"><a href="#열의-생성과-삭제">열의 생성과 삭제</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#2장-기본-데이터프레임-연산">2장 기본 데이터프레임 연산</a>
<ul>
<li class="toc-entry toc-h2"><a href="#여러-데이터프레임-열-선택">여러 데이터프레임 열 선택</a></li>
<li class="toc-entry toc-h2"><a href="#메서드를-사용해-열-선택">메서드를 사용해 열 선택</a></li>
<li class="toc-entry toc-h2"><a href="#열-이름-정렬">열 이름 정렬</a></li>
<li class="toc-entry toc-h2"><a href="#데이터프레임-요약">데이터프레임 요약</a></li>
<li class="toc-entry toc-h2"><a href="#데이터프레임-메서드-체인">데이터프레임 메서드 체인</a></li>
<li class="toc-entry toc-h2"><a href="#데이터프레임-연산">데이터프레임 연산</a></li>
<li class="toc-entry toc-h2"><a href="#결측치-비교">결측치 비교</a></li>
<li class="toc-entry toc-h2"><a href="#데이터프레임-연산-방향-전환">데이터프레임 연산 방향 전환</a></li>
<li class="toc-entry toc-h2"><a href="#대학-인종-다양성-지수-결정">대학 인종 다양성 지수 결정</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#3장-데이터프레임-생성과-유지">3장 데이터프레임 생성과 유지</a>
<ul>
<li class="toc-entry toc-h2"><a href="#스크래치에서-데이터프레임-생성">스크래치에서 데이터프레임 생성</a></li>
<li class="toc-entry toc-h2"><a href="#csv-작성">CSV 작성</a></li>
<li class="toc-entry toc-h2"><a href="#대형-csv-파일-읽기">대형 CSV 파일 읽기</a></li>
<li class="toc-entry toc-h2"><a href="#엑셀-파일-사용">엑셀 파일 사용</a></li>
<li class="toc-entry toc-h2"><a href="#zip-파일로-작업">ZIP 파일로 작업</a></li>
<li class="toc-entry toc-h2"><a href="#데이터베이스와-작업">데이터베이스와 작업</a></li>
<li class="toc-entry toc-h2"><a href="#json-파일-읽기">JSON 파일 읽기</a></li>
<li class="toc-entry toc-h2"><a href="#html-테이블-읽기">HTML 테이블 읽기</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#데이터-분석-시작">데이터 분석 시작</a>
<ul>
<li class="toc-entry toc-h2"><a href="#데이터-분석-루틴-개발">데이터 분석 루틴 개발</a></li>
</ul>
</li>
</ul><h1 id="1장-판다스-기초">
<a class="anchor" href="#1%EC%9E%A5-%ED%8C%90%EB%8B%A4%EC%8A%A4-%EA%B8%B0%EC%B4%88" aria-hidden="true"><span class="octicon octicon-link"></span></a>1장 판다스 기초</h1>
<h2 id="판다스-임포트">
<a class="anchor" href="#%ED%8C%90%EB%8B%A4%EC%8A%A4-%EC%9E%84%ED%8F%AC%ED%8A%B8" aria-hidden="true"><span class="octicon octicon-link"></span></a>판다스 임포트</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>
<p>데이터 프레임에서 단일 열을 선택하면 결과는 시리즈(1차원 데이터셋)으로 반환된다. <br>
많은 시리즈 메서드가 반환하는 출력은 시리즈다.</p>

<h2 id="판다스-데이터프레임-해부하기">
<a class="anchor" href="#%ED%8C%90%EB%8B%A4%EC%8A%A4-%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%ED%95%B4%EB%B6%80%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>판다스 데이터프레임 해부하기</h2>
<p>데이터프레임은 인덱스(index), 열(columns), 데이터(data)라는 세 가지 구성요소가 있다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'max_columns'</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="s">'max_rows'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p>열과 인덱스를 통칭해 축이라고 한다. 인덱스는 축 0번이고 열은 축 1번이다.
판다스는 NaN(Not a Number)을 사용해 결측치를 나타낸다.</p>

<h2 id="데이터프레임-속성">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%86%8D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터프레임 속성</h2>
<p>일반적으로 데이터를 넘파이 배열로 가져올 수 있지만 모든 열이 수치가 아닌 이상 데이터프레임에 그대로 둔다.<br>
데이터프레임은 열들의 데이터 형식이 서로 다른 경우를 관리하는 데 이상적이지만 넘파이 배열은 그렇지 않다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">columns</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">columns</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">index</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">values</span>
</code></pre></div></div>
<p>인덱스의 타입은 pandas.core.indexes.range.RangeIndex<br>
컬럼의 타입은 pandas.core.indexes.base.Index <br>
데이터의 타입은 numpy.ndarray<br>
인덱스와 열은 둘 다 Index의 서브클래스이다.<br>
판다스에는 여러 형식의 인덱스 객체가 있다. 인덱스를 지정하지 않으면 판다스는 RangeIndex를 사용한다. <br>
전체 값은 필요할 때까지 메모리에 로드되지 않으므로 메모리가 절약된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">index</span><span class="p">.</span><span class="n">values</span>
<span class="n">columns</span><span class="p">.</span><span class="n">values</span>
</code></pre></div></div>
<p>판다스의 대부분은 ndarray에 크게 의존한다. 인덱스, 열, 데이터의 이면에는 넘파이 ndarray가 있다.</p>

<h2 id="데이터-형식-이해">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%98%95%EC%8B%9D-%EC%9D%B4%ED%95%B4" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터 형식 이해</h2>
<p>데이터는 연속형과 범주형으로 크게 분류할 수 있다.</p>
<ul>
  <li>float : 넘파이 부동소수점수 형식으로 결측치를 지원한다.</li>
  <li>int : 넘파이 정수 형식으로 결측치를 지원하지 않는다.</li>
  <li>‘Int64’ : Null 값을 지원하는 판다스 정수 형식이다.</li>
  <li>object : 문자열(과 혼합형식)을 저장하는 넘파이 형식이다.</li>
  <li>‘category’ : 판다스 범주형으로, 결측치를 지원한다.</li>
  <li>bool : 넘파이 불리언 형식으로 결측치를 지원하지 않는다.(None은 False, np.nan은 True로 취급)</li>
  <li>‘boolean’ : Null 값을 지원하는 판다스 불리언 형식이다.</li>
  <li>datetime64[ns] : 넘파이 날짜 형식으로 결측치(NaT)를 지원한다.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span><span class="p">.</span><span class="n">dtypes</span> <span class="c1"># Series
</span><span class="n">movies</span><span class="p">.</span><span class="n">dtypes</span><span class="p">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="c1"># Series
</span><span class="n">moives</span><span class="p">.</span><span class="n">info</span><span class="p">()</span> <span class="c1"># None Type
</span></code></pre></div></div>

<p>데이터프레임의 각 열별로 하나의 데이터 형식이 나열된다.<br>
판다스는 데이터를 표현하기 위한 적정 메모리 용량과 상관없이 핵심 수치 형식인 정수와 부동소수점수를 나타내는 데 64비트를 사용한다.<br>
열 전체가 정수 0으로만 구성돼 있더라도 여전히 데이터 형식인 int64인 것이다.<br>
.value_counts 메서드가 .dtypes 속성에서 호출되면 데이터프레임의 모든 데이터 형식의 개수를 반환한다.<br>
object 데이터 형식으로 된 열은 유효한 모든 파이썬 객체를 포함할 수 있다.<br>
info 메서드는 null이 아닌 값의 개수와 함께 데이터 형식 정보를 출력한다. 또한 데이터프레임에서 사용된 메모리 크기가 나열된다.<br>
카테고리 형식은 가능한 가지수로만 이뤄진 고정 개수의 문자열을 처리하고자 만들어졌다.</p>

<h2 id="열-선택">
<a class="anchor" href="#%EC%97%B4-%EC%84%A0%ED%83%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>열 선택</h2>
<p>데이터 프레임에서 단일 열을 선택하면 시리즈가 반환된다. 이 시리즈는 1차원 데이터로 인덱스와 데이터로만 구성된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">]</span> <span class="c1"># Series
</span><span class="n">movies</span><span class="p">.</span><span class="n">director_name</span> <span class="c1"># Series
</span><span class="n">movies</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'director_name'</span><span class="p">]</span> <span class="c1"># Series
</span><span class="n">movies</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># Series
</span><span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">].</span><span class="n">index</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">].</span><span class="n">dtype</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">].</span><span class="n">size</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">].</span><span class="n">name</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="nb">type</span><span class="p">).</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>

<p>시리즈를 추출하는 데 다양한 방법이 있다.  .loc와 .iloc 속성을 사용할 수도 있다. <br>
전자는 열 이름을 끄집어내는 데 사용할 수 있고, 후자는 위치로 지정한다.<br>
판다스 문서상에서 이 둘은 각각 ‘라벨 기반’과 ‘위치 기반’으로 부른다.<br>
.loc의 사용법은 콤마(,)를 사용해 행과 열 모두를 지정하는 것이다. <br>
.iloc도 행과 열 선택자를 모두 선택한다. <br>
적절한 속성을 사용하면 시리즈의 인덱스, 형식, 길이, 이름도 볼 수 있다.<br>
.unique 메서드를 체인시켜 director_name 열 중에서 고유한 형식만 살펴볼 수 있다.</p>

<p>판다스 데이터프레임은 대게 여러 개의 열을 가진다. 각 열은 시리즈 형태로 끄집어내 사용할 수 있다.<br>
인덱스 연산자(‘[]’)를 사용하면 어떤 열 이름도 사용할 수 있다.</p>

<h2 id="시리즈-메서드-호출">
<a class="anchor" href="#%EC%8B%9C%EB%A6%AC%EC%A6%88-%EB%A9%94%EC%84%9C%EB%93%9C-%ED%98%B8%EC%B6%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>시리즈 메서드 호출</h2>
<p>시리즈가 가진 모든 속성과 메서드를 찾아보려면 내장된 dir함수를 사용하면 된다.<br>
다음 코드는 시리즈와 데이터프레임에서 공통적인 속성과 메서드 개수를 보여준다.<br>
이 두 객체는 상당수의 속성과 메서드 이름을 공유한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s_attr_methods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">s_attr_methods</span><span class="p">)</span>
<span class="n">df_attr_methods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">df_attr_methods</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">s_attr_methods</span> <span class="o">&amp;</span> <span class="n">df_attr_methods</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">director</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">]</span>
<span class="n">fb_likes</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="s">'actor_1_facebook_likes'</span><span class="p">]</span>
<span class="n">director</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">director</span><span class="p">.</span><span class="n">shape</span>
<span class="n">director</span><span class="p">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">director</span><span class="p">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">quantile</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="nb">min</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">quantile</span><span class="p">(.</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">quantile</span><span class="p">([.</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="p">.</span><span class="mi">7</span><span class="p">,</span> <span class="p">.</span><span class="mi">8</span><span class="p">,</span> <span class="p">.</span><span class="mi">9</span><span class="p">])</span>
<span class="n">director</span><span class="p">.</span><span class="n">isna</span><span class="p">()</span>
<span class="n">fb_likes_filled</span> <span class="o">=</span> <span class="n">fb_likes</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fb_likes_filled</span><span class="p">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">fb_likes_dropped</span> <span class="o">=</span> <span class="n">fb_likes</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">fb_likes_dropped</span><span class="p">.</span><span class="n">size</span>
</code></pre></div></div>

<p>일반적으로 시리즈의 데이터 형식에 따라 가장 유용한 메서드가 달라진다. 예를 들어 object 데이터 형식의 시리즈에 가장 유용한 메서드 중 하나는 빈도를 계산하는 .value_counts()다.<br>
시리즈의 원소 개수는 .size나 .shape 속성이나 내장된 len 함수를 사용해 계산할 수 있다.<br>
.unique() 메서드는 고유한 원소를 담은 넘파이 배열을 반환한다. <br>
.count() 메서드는 결측치가 아닌 아이템 개수를 반환한다.<br>
.min(), .max(), .mean(), .median(), .std() 등의 기본적 통계량도 제공된다.<br>
.describe() 메서드를 사용해 요약 통계량과 함께 몇 가지 분위수를 동시에 표현할 수 있다. 다만 object 데이터 형식의 열에 적용하면 완전히 다른 출력이 반환된다. <br>
.quantile() 메서드는 수치 데이터의 분위수를 계산한다. 입력이 스칼라면 출력도 스칼라지만 입력이 리스트면 출력은 시리즈다.<br>
.isna() 메서드를 사용하면 각 개별 값의 결측치 여부를 알 수 있다. 결과는 불리언 배열 시리즈다.<br>
.fillna() 메서드를 사용하면 시리즈 내의 모든 결측치를 다른 값으로 대체할 수 있다.<br>
.dropna() 메서드를 사용하면 시리즈 내의 결측치를 제거한다. <br>
각 메서드에서 반환되는 객체들은 형식이 서로 다르다.<br>
.value_counts() 메서드는 가장 유익한 시리즈 메서드 중 하나다. 기본 설정으로는 개수를 반환하지만 normalize 매개변수를 True로 설정하면 개수 대신 상대빈도값이 반환된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">director</span><span class="p">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">director</span><span class="p">.</span><span class="n">hasnans</span>
<span class="n">director</span><span class="p">.</span><span class="n">notna</span><span class="p">()</span>
</code></pre></div></div>
<p>.hasnans 속성으로 결측치 여부를 검사할 수 있다.<br>
.notna() 메서드는 결측치가 아닌 모든 값에 대해 True를 반환한다.</p>

<h2 id="시리즈-연산">
<a class="anchor" href="#%EC%8B%9C%EB%A6%AC%EC%A6%88-%EC%97%B0%EC%82%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>시리즈 연산</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">imdb_score</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="s">'imdb_score'</span><span class="p">]</span>
<span class="n">imdb_score</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">imdb_score</span> <span class="o">*</span> <span class="mf">2.5</span>
<span class="n">imdb_score</span> <span class="o">//</span> <span class="mi">7</span>
<span class="n">imdb_score</span> <span class="o">&gt;</span> <span class="mi">7</span>
<span class="n">director</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">]</span>
<span class="n">director</span> <span class="o">==</span> <span class="s">'James Cameron'</span>
<span class="n">imdb_score</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># imdb_score + 1
</span><span class="n">imdb_score</span><span class="p">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># imdb_score &gt; 7
</span></code></pre></div></div>

<p>뺄셈, 곱셈, 나눗셈, 지수와 같은 기본 산술 연산자도 스칼라 값과 유사하게 작동한다.<br>
파이썬에서 //는 몫을 구하는 나눗셈 연산이다. 이 연산은 결과를 내림한다.<br>
% 기호는 나머지를 구하는 연산으로, 나눗셈을 하고 난 나머지를 반환한다. 시리즈 인스턴스는 이 연산들을 지원한다.<br>
6개의 비교연산자도 존재하는데 각 비교연산자는 각 조건 결과에 기반을 두고 시리즈 각 값에 대해 True나 False를 반환한다.<br>
결과는 불리언 배열이며, 필터링에서 매우 유용하게 쓰인다.<br>
모든 연산자에는 동일한 결과를 생성하는 메서드가 있다. 연산자 대신 메서드를 사용하면 메서드를 체인시킬 때 유용하다.<br>
연산자로 뺄셈을 하면 결측치가 무시된다. 그러나 .sub() 메서드를 사용하면 결측치 대신 사용할 fill_value 매게변수를 지정할 수 있다.</p>
<ul>
  <li>+, -, *, /, //, %, ** : .add(), .sub(), .mul(), .div(), .floordiv(), .mod(), .pow()</li>
  <li>&lt;, &gt;, &lt;=, &gt;=, ==, != : .lt(), .gt(), .le(), .ge(), .eq(), .ne()
특정 시리즈의 각 요소에 2.5를 곱해야 한다는 것을 파이썬은 어떻게 알 수 있을까?<br>
파이썬의 객체는 특수 메서드를 사용해 연산자와 통신할 수 있는 표준화된 내장방법을 갖고 있다.<br>
특수 메서드는 객체가 연산자를 만날 때마다 내부적으로 호출된다. 특수 메서드는 항상 밑줄 두 개로 시작하고 끝난다. 따라서 던더 메서드라고도 한다.<br>
파이썬은 imdb_score * 2.5 표현식을 imdb_score.<strong>mul</strong>(2.5)로 해석한다. <br>
참고로 .mul() 메서드를 호출하는 것은 .<strong>mul</strong>() 메서드를 호출하는 것과 다르다.</li>
</ul>

<h2 id="시리즈-메서드-체인">
<a class="anchor" href="#%EC%8B%9C%EB%A6%AC%EC%A6%88-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%B2%B4%EC%9D%B8" aria-hidden="true"><span class="octicon octicon-link"></span></a>시리즈 메서드 체인</h2>
<p>파이썬에서 모든 변수는 객체를 참조하며, 여러 속성과 메서드는 새로운 객체를 반환한다. 이 덕분에 속성 접근을 사용해 메서드를 연속으로 호출할 수 있다.<br>
이러한 방법을 메서드 체인 또는 플로우 프로그래밍이라 부른다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">fb_likes</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="s">'actor_1_facebook_likes'</span><span class="p">]</span>
<span class="n">director</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">]</span>
<span class="n">director</span><span class="p">.</span><span class="n">value_counts</span><span class="p">().</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">isna</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">dtype</span>
<span class="p">(</span><span class="n">fb_likes</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
         <span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>
<p>체인 끝에 추가되는 가장 흔한 두 가지 메서드는 .head()나 .sample()이다.<br>
결측치의 개수를 알아내는 일반적인 방법은 .isna()를 호출한 후 .sum()메서드를 체인시키는 것이다.<br>
.astype() 메서드를 사용해 데이터 타입을 바꿀 수 있다. 
체인의 잠재적 단점 중 하나는 디버깅이 어렵다는 것이다. <br>
메서드 호출 중에 생성된 중간 객체는 별도의 변수에 저장되지 않으므로 체인 중에서 발생한 오류의 정확한 위치를 추적하기 어렵다.<br>
체인 디버깅을 위한 옵션은 .pipe() 메서드를 호출해 중간값을 표시하는 것이다.<br>
시리즈에 대한 .pipe() 메서드에서는 시리즈를 입력으로 취하는 함수를 전달해야만 하고 함수의 출력은 무엇이든 가능하다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">fb_likes</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="c1">#.astype(int)
</span>         <span class="c1">#.head()
</span><span class="p">)</span>
<span class="p">(</span><span class="n">fb_likes</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
         <span class="c1">#.head()
</span><span class="p">)</span>
<span class="n">fb_likes</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">debug_df</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"BEFORE"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"AFTER"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
<span class="p">(</span><span class="n">fb_likes</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="p">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">debug_df</span><span class="p">)</span>
         <span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> 
         <span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">intermediate</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">def</span> <span class="nf">get_intermediate</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">intermediate</span>
    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">df</span>
    <span class="k">return</span> <span class="n">df</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">fb_likes</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="p">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_intermediate</span><span class="p">)</span>
         <span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> 
         <span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>
<p>중간값을 저장하는 전역 변수를 생성하고 .pipe() 메서드를 사용할 수 있다. 
체인을 괄호로 묶는 것을 선호한다. 체인에 메서드를 추가할 때마다 후행 백슬래시를 계속 추가해야 하는 것은 성가신 일이다.</p>

<h2 id="열-이름-변경">
<a class="anchor" href="#%EC%97%B4-%EC%9D%B4%EB%A6%84-%EB%B3%80%EA%B2%BD" aria-hidden="true"><span class="octicon octicon-link"></span></a>열 이름 변경</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">col_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'director_name'</span><span class="p">:</span><span class="s">'Director Name'</span><span class="p">,</span> 
             <span class="s">'num_critic_for_reviews'</span><span class="p">:</span> <span class="s">'Critical Reviews'</span><span class="p">}</span> 
<span class="n">movies</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_map</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p>데이터 프레임의 .rename() 메서드를 사용하면 열 레이블의 이름을 바꿀 수 있다.<br>
columns 속성에 대입하면 열 이름이 바뀐다. 그러나 이 대입을 체인시킬 수 없다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idx_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Avatar'</span><span class="p">:</span><span class="s">'Ratava'</span><span class="p">,</span> <span class="s">'Spectre'</span><span class="p">:</span> <span class="s">'Ertceps'</span><span class="p">,</span>
  <span class="s">"Pirates of the Caribbean: At World's End"</span><span class="p">:</span> <span class="s">'POC'</span><span class="p">}</span>
<span class="n">col_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'aspect_ratio'</span><span class="p">:</span> <span class="s">'aspect'</span><span class="p">,</span>
  <span class="s">"movie_facebook_likes"</span><span class="p">:</span> <span class="s">'fblikes'</span><span class="p">}</span>
<span class="p">(</span><span class="n">movies</span>
   <span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'movie_title'</span><span class="p">)</span>
   <span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">idx_map</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_map</span><span class="p">)</span>
   <span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'movie_title'</span><span class="p">)</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Ratava'</span>
<span class="n">ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">'POC'</span>
<span class="n">ids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Ertceps'</span>
<span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">'director'</span>
<span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s">'aspect'</span>
<span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">'fblikes'</span>
<span class="n">movies</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ids</span>
<span class="n">movies</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

<span class="k">def</span> <span class="nf">to_clean</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">lower</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span>

<span class="n">movies</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_clean</span><span class="p">).</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">lower</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">movies</span><span class="p">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">movies</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
<span class="n">movies</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>
<p>원하는 경우 .rename()를 사용해 인덱스의 이름을 바꿀 수도 있다.<br>
행과 열 레이블의 이름을 바꾸는 방법에는 여러 가지가 있다. 인덱스와 열 속성을 파이썬 리스트에 다시 대입할 수도 있다.<br>
이 경우 리스트에 행과 열 레이블과 동일한 개수의 원소가 있을 때 작동한다. 
.rename() 메서드에 함수를 전달할 수도 있다. 이 함수는 열 이름을 취한 뒤 새 이름을 반환한다.<br>
리스트 컴프리핸션도 사용할 수 있다. 새로 정리된 목록을 .columns 특성으로 다시 할당하면 된다.</p>

<h2 id="열의-생성과-삭제">
<a class="anchor" href="#%EC%97%B4%EC%9D%98-%EC%83%9D%EC%84%B1%EA%B3%BC-%EC%82%AD%EC%A0%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>열의 생성과 삭제</h2>

<p>.assign() 메서드를 사용해 새 열을 만든 다음 .drop() 메서드를 사용해 열을 삭제한다. 
새 열을 만드는 한 가지 방법은 인덱스 대입을 실행하는 것이다. 기본적으로 새 열은 마지막에 추가된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'has_seen'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></div>
<p>체인을 많이 사용하는 경우 .assign() 메서드를 사용하자. 이 메서드는 새 열이 추가된 새로운 데이터프레임을 반환한다.<br>
이 메서드는 매개변수 이름을 열 이름으로 사용하므로 열 이름은 유효한 매개변수 이름이어야 한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idx_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Avatar'</span><span class="p">:</span><span class="s">'Ratava'</span><span class="p">,</span> <span class="s">'Spectre'</span><span class="p">:</span> <span class="s">'Ertceps'</span><span class="p">,</span>
  <span class="s">"Pirates of the Caribbean: At World's End"</span><span class="p">:</span> <span class="s">'POC'</span><span class="p">}</span>
<span class="n">col_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'aspect_ratio'</span><span class="p">:</span> <span class="s">'aspect'</span><span class="p">,</span>
  <span class="s">"movie_facebook_likes"</span><span class="p">:</span> <span class="s">'fblikes'</span><span class="p">}</span>
<span class="p">(</span><span class="n">movies</span>
   <span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">idx_map</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_map</span><span class="p">)</span>
   <span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">has_seen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>
<p>페이스북의 ‘좋아요’ 개수에 대한 데이터를 합산해 total_likes 열에 할당하자.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total</span> <span class="o">=</span> <span class="p">(</span><span class="n">movies</span><span class="p">[</span><span class="s">'actor_1_facebook_likes'</span><span class="p">]</span> <span class="o">+</span>
         <span class="n">movies</span><span class="p">[</span><span class="s">'actor_2_facebook_likes'</span><span class="p">]</span> <span class="o">+</span> 
         <span class="n">movies</span><span class="p">[</span><span class="s">'actor_3_facebook_likes'</span><span class="p">]</span> <span class="o">+</span> 
         <span class="n">movies</span><span class="p">[</span><span class="s">'director_facebook_likes'</span><span class="p">])</span>
</code></pre></div></div>
<p>이번엔 체인할 수 있는 메서드를 사용해보자.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'actor_1_facebook_likes'</span><span class="p">,</span><span class="s">'actor_2_facebook_likes'</span><span class="p">,</span>
    <span class="s">'actor_3_facebook_likes'</span><span class="p">,</span><span class="s">'director_facebook_likes'</span><span class="p">]</span>
<span class="n">sum_col</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">cols</span><span class="p">].</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'columns'</span><span class="p">)</span>
<span class="n">sum_col</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">total_likes</span><span class="o">=</span><span class="n">sum_col</span><span class="p">).</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>
<p>또 다른 옵션은 .assign() 메서드 호출에서 매개변수 값으로 함수를 전달하는 것이다. 이 함수는 데이터프레임을 입력으로 받고 시리즈를 반환한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sum_likes</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">df</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span>
              <span class="k">if</span> <span class="s">'like'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]].</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">total_likes</span><span class="o">=</span><span class="n">sum_likes</span><span class="p">).</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>
<p>이 데이터셋에는 결측치가 있다. + 연산자를 사용하면 결측치가 있을 경우 결과는 NaN이 된다.<br>
그러나 .sum() 메서드를 사용하면 NaN을 0으로 반환한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">movies</span>
   <span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">total_likes</span><span class="o">=</span><span class="n">sum_col</span><span class="p">)</span>
   <span class="p">[</span><span class="s">'total_likes'</span><span class="p">]</span>
   <span class="p">.</span><span class="n">isna</span><span class="p">()</span>
   <span class="p">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">movies</span>
   <span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">total_likes</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>
   <span class="p">[</span><span class="s">'total_likes'</span><span class="p">]</span>
   <span class="p">.</span><span class="n">isna</span><span class="p">()</span>
   <span class="p">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">movies</span>
   <span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">total_likes</span><span class="o">=</span><span class="n">total</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
   <span class="p">[</span><span class="s">'total_likes'</span><span class="p">]</span>
   <span class="p">.</span><span class="n">isna</span><span class="p">()</span>
   <span class="p">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="p">)</span>              
</code></pre></div></div>
<p>데이터셋에는 cast_total_facebook_likes라는 열이 있다.<br>
이 열 중 얼마나 많은 부분이 방금 새로 만든 열인 total_likes에서 왔는지 확인해보자.<br>
우선 데이터 유효성 검사를 수행하자.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cast_like_gt_actor_director</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s">'cast_total_facebook_likes'</span><span class="p">]</span> <span class="o">&gt;=</span> \
           <span class="n">df</span><span class="p">[</span><span class="s">'total_likes'</span><span class="p">]</span>
<span class="n">df2</span> <span class="o">=</span> <span class="p">(</span><span class="n">movies</span>
   <span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">total_likes</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
           <span class="n">is_cast_likes_more</span> <span class="o">=</span> <span class="n">cast_like_gt_actor_director</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">df2</span><span class="p">[</span><span class="s">'is_cast_likes_more'</span><span class="p">].</span><span class="nb">all</span><span class="p">()</span>
</code></pre></div></div>
<p>.all() 메서드를 사용하면 해당 열의 모든 값이 True인지 확인할 수 있다. 
이번엔 total_likes 컬럼을 삭제해보자.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">'total_likes'</span><span class="p">)</span>
</code></pre></div></div>
<p>배우들이 받은 ‘좋아요’만을 가진 새로운 시리즈를 생성하고 cast_total_facebook_likes에 있는 모든 값이 actor_sum보다 크거나 같은지 확인해보자. <br>
그런 다음 movie_title 열을 인덱스로 사용해 시리즈를 생성할 수 있다.<br>
시리즈 생성자에는 값과 인덱스 모두를 전달할 수 있다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">actor_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">movies</span>
   <span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">movies</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s">'actor_'</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s">'_likes'</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]]</span>
   <span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'columns'</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'cast_total_facebook_likes'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">actor_sum</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'cast_total_facebook_likes'</span><span class="p">].</span><span class="n">ge</span><span class="p">(</span><span class="n">actor_sum</span><span class="p">)</span>
<span class="n">movies</span><span class="p">[</span><span class="s">'cast_total_facebook_likes'</span><span class="p">].</span><span class="n">ge</span><span class="p">(</span><span class="n">actor_sum</span><span class="p">).</span><span class="nb">all</span><span class="p">()</span>
<span class="n">pct_like</span> <span class="o">=</span> <span class="p">(</span><span class="n">actor_sum</span>
    <span class="p">.</span><span class="n">div</span><span class="p">(</span><span class="n">movies</span><span class="p">[</span><span class="s">'cast_total_facebook_likes'</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">pct_like</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span>
    <span class="n">pct_like</span><span class="p">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="c1"># or pct_like.values
</span>    <span class="n">index</span><span class="o">=</span><span class="n">movies</span><span class="p">[</span><span class="s">'movie_title'</span><span class="p">].</span><span class="n">values</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>요약해보자.<br>
새 열을 생성할 때 스칼라를 대입하거나 시리즈를 대입할 수 있다. 
.drop() 메서드는 삭제할 행이나 열 이름을 취한다. 기본 설정은 인덱스 이름을 기준으로 행을 삭제한다.<br>
열을 삭제하려면 axis 매개변수를 1이나 ‘columns’로 설정해야 한다.<br>
축의 기본 설정값은 0이나 ‘index’이다.<br>
.insert() 메서드를 사용해 데이터프레임의 특정 위치에 새 열을 삽입할 수 있다.<br>
이 메서드는 새 열의 정수 위치를 첫 번째 인수로, 새 열의 이름을 두 번째 인수로, 값을 세 번째 인수로 취한다.<br>
열 이름의 정수 위치를 찾으려면 .get_loc 인덱스 메서드를 사용해야 한다.<br>
그리고 이 메서드는 데이터프레임 자체를 수정하므로 대입 명령문이 없다. 그리고 None을 반환한다.<br>
이러한 이유로 .assign() 메서드를 선호한다. 
각 영화의 수익을 계산하려면 총매출에서 비용을 제외한 후 gross 열 다음에 삽입하면 된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">profit_index</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s">'gross'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">profit_index</span>
<span class="n">movies</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">profit_index</span><span class="p">,</span>
              <span class="n">column</span><span class="o">=</span><span class="s">'profit'</span><span class="p">,</span>
              <span class="n">value</span><span class="o">=</span><span class="n">movies</span><span class="p">[</span><span class="s">'gross'</span><span class="p">]</span> <span class="o">-</span> <span class="n">movies</span><span class="p">[</span><span class="s">'budget'</span><span class="p">])</span>

<span class="k">del</span> <span class="n">movies</span><span class="p">[</span><span class="s">'director_name'</span><span class="p">]</span>
</code></pre></div></div>
<p>컬럼을 삭제하는 대안은 del문을 사용하는 것이다.<br>
그러나 이 또한 새로운 데이터프레임을 반환하지 않으므로 .drop() 메서드를 선호한다.</p>

<h1 id="2장-기본-데이터프레임-연산">
<a class="anchor" href="#2%EC%9E%A5-%EA%B8%B0%EB%B3%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%97%B0%EC%82%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>2장 기본 데이터프레임 연산</h1>
<h2 id="여러-데이터프레임-열-선택">
<a class="anchor" href="#%EC%97%AC%EB%9F%AC-%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%97%B4-%EC%84%A0%ED%83%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>여러 데이터프레임 열 선택</h2>
<p>원하는 열의 리스트를 인덱스 연산자에 전달한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">movie_actor_director</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[[</span><span class="s">'actor_1_name'</span><span class="p">,</span> <span class="s">'actor_2_name'</span><span class="p">,</span> <span class="s">'actor_3_name'</span><span class="p">,</span> <span class="s">'director_name'</span><span class="p">]]</span>
<span class="n">movie_actor_director</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="nb">type</span><span class="p">(</span><span class="n">movies</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s">'director_name'</span><span class="p">]])</span> <span class="c1"># DataFrame
</span><span class="nb">type</span><span class="p">(</span><span class="n">movies</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'director_name'</span><span class="p">])</span> <span class="c1"># Series
</span></code></pre></div></div>
<p>.loc을 사용해 열 이름으로 꺼낼 수 있다. 콜론을 사용해 전체 행을 선택한다는 것을 명시해야 한다.<br>
인덱스 연산을 사용하면 시리즈나 데이터프레임을 반환할 수 있다. <br>
단일 아이템을 가진 리스트를 전달하면 데이터프레임을 반환받는다.<br>
문자열로 된 열의 이름을 전달하면 시리즈를 반환받는다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'actor_1_name'</span><span class="p">,</span> <span class="s">'actor_2_name'</span><span class="p">,</span>
        <span class="s">'actor_3_name'</span><span class="p">,</span> <span class="s">'director_name'</span><span class="p">]</span>
<span class="n">movie_actor_director</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
</code></pre></div></div>
<p>인덱스 연산자 내에 긴 리스트를 전달하면 가독성 문제가 발생할 수 있다.<br>
이를 피하고자 필요한 열 이름을 리스트 변수에 먼저 저장할 수 있다.<br>
판다스로 작업할 때 발생하는 가장 일반적인 예외 상황 중 하나는 KeyError다.<br>
이 오류는 주로 열이나 인덱스 이름이 잘못되었을 경우 발생한다.</p>

<h2 id="메서드를-사용해-열-선택">
<a class="anchor" href="#%EB%A9%94%EC%84%9C%EB%93%9C%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-%EC%97%B4-%EC%84%A0%ED%83%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>메서드를 사용해 열 선택</h2>
<p>.select_dtypes()와 .filter() 메서드를 사용할 수 있다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">shorten</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">col</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'facebook_likes'</span><span class="p">,</span> <span class="s">'fb'</span><span class="p">)</span>
               <span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'_for_reviews'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">shorten</span><span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">dtypes</span><span class="p">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s">'int'</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s">'number'</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s">'int'</span><span class="p">,</span> <span class="s">'object'</span><span class="p">]).</span><span class="n">head</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s">'float'</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s">'fb'</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'actor_1_name'</span><span class="p">,</span> <span class="s">'actor_2_name'</span><span class="p">,</span>
        <span class="s">'actor_3_name'</span><span class="p">,</span> <span class="s">'director_name'</span><span class="p">]</span>
<span class="n">movies</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">cols</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s">r'\d'</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p>.select_dtypes() 메서드를 사용해 특정 데이터 타입을 지닌 열을 선택할 수 있다. <br>
모든 수치 열만 선택하려면 include 매개변수에 number라는 문자열을 전달하면 된다. <br>
리스트로 넘겨서 정수와 문자열로 된 열을 얻을 수 있다.<br>
제외하고 싶을 땐 exclude 매개변수를 이용하자.<br>
열을 선택하는 다른 방법은 .filter() 메서들르 이용하는 것이다.<br>
like 매개변수는 열 이름에서 부분 문자열을 찾는다.<br>
items 매개변수를 사용하면 열 이름을 리스트로 전달할 수 있다. 이 매개변수는 거의 인덱스 연산을 복제한 것과 같다. 그러나 KeyError가 발생하지 않는다.<br>
그리고 regex 매개변수로 정규표현식을 사용해 열을 검색할 수 있다.<br>
items, like, regex 중 하나의 매개변수만 사용할 수 있다.<br>
.select_dtypes() 메서드의 혼란스러운 점 중 하나는 문자열과 파이썬 객체를 모두 사용할 수 있다는 유연성이다.<br>
둘 다 알아놓자.</p>
<ul>
  <li>np.number, ‘number’ : 크기와 상관없이 정수와 부동소수를 모두 선택</li>
  <li>np.float64, np.float_, float, ‘float64’, ‘float_’, ‘float’ : 64비트 부동소수점 수만 선택</li>
  <li>np.float16, np.float32, np.float128, ‘float16’, ‘float32’, ‘float128’ : 각각 정확히 16, 32, 128비트 부동소수점 수 선택</li>
  <li>np.floating, ‘floating’ : 크기와 상관없이 부동소수점 수 선택</li>
  <li>np.int0, np.int64, np.int_, int, ‘int0’, ‘int64’, ‘int_’, ‘int’ : 정확히 64비트 정수만 선택</li>
  <li>np.int8, np.int16, np.int32, ‘int8’, ‘int16’, ‘int32’ : 각각 정확히 8, 16, 32비트 정수 선택</li>
  <li>np.integer, ‘integer’ : 크기와 상관없이 모든 정수</li>
  <li>‘Int64’ : null 값을 허용하는 정수로, 넘파이에는 없음</li>
  <li>np.object, ‘object’, ‘O’ : 모든 object 데이터 형식</li>
  <li>np.datetime64, ‘datetime64’, ‘datetime’ : 모든 datetime은 64비트</li>
  <li>np.timedelta64, ‘timedelta64’, ‘timedelta’ : 모든 timedelta는 64비트</li>
  <li>pd.Categorical, ‘category’ : 판다스에만 존재하고 넘파이에는 없음</li>
</ul>

<h2 id="열-이름-정렬">
<a class="anchor" href="#%EC%97%B4-%EC%9D%B4%EB%A6%84-%EC%A0%95%EB%A0%AC" aria-hidden="true"><span class="octicon octicon-link"></span></a>열 이름 정렬</h2>
<p>다음은 열을 정렬하는 지침이다.</p>
<ul>
  <li>각 열을 범주형이나 연속형으로 분류하라.</li>
  <li>범주형과 연속형 열 내에서 공통된 열을 그룹화하라.</li>
  <li>가장 중요한 열 그룹을 먼저 위치시키고 연속형보다 범주형 열을 먼저 위치시켜라.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">shorten</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">col</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'facebook_likes'</span><span class="p">,</span> <span class="s">'fb'</span><span class="p">)</span>
               <span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'_for_reviews'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">shorten</span><span class="p">)</span>
<span class="n">cat_core</span> <span class="o">=</span> <span class="p">[</span><span class="s">'movie_title'</span><span class="p">,</span> <span class="s">'title_year'</span><span class="p">,</span>
            <span class="s">'content_rating'</span><span class="p">,</span> <span class="s">'genres'</span><span class="p">]</span>
<span class="n">cat_people</span> <span class="o">=</span> <span class="p">[</span><span class="s">'director_name'</span><span class="p">,</span> <span class="s">'actor_1_name'</span><span class="p">,</span>
              <span class="s">'actor_2_name'</span><span class="p">,</span> <span class="s">'actor_3_name'</span><span class="p">]</span>
<span class="n">cat_other</span> <span class="o">=</span> <span class="p">[</span><span class="s">'color'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">,</span> <span class="s">'language'</span><span class="p">,</span>
             <span class="s">'plot_keywords'</span><span class="p">,</span> <span class="s">'movie_imdb_link'</span><span class="p">]</span>
<span class="n">cont_fb</span> <span class="o">=</span> <span class="p">[</span><span class="s">'director_fb'</span><span class="p">,</span> <span class="s">'actor_1_fb'</span><span class="p">,</span>
           <span class="s">'actor_2_fb'</span><span class="p">,</span> <span class="s">'actor_3_fb'</span><span class="p">,</span>
           <span class="s">'cast_total_fb'</span><span class="p">,</span> <span class="s">'movie_fb'</span><span class="p">]</span>
<span class="n">cont_finance</span> <span class="o">=</span> <span class="p">[</span><span class="s">'budget'</span><span class="p">,</span> <span class="s">'gross'</span><span class="p">]</span>
<span class="n">cont_num_reviews</span> <span class="o">=</span> <span class="p">[</span><span class="s">'num_voted_users'</span><span class="p">,</span> <span class="s">'num_user'</span><span class="p">,</span>
                    <span class="s">'num_critic'</span><span class="p">]</span>
<span class="n">cont_other</span> <span class="o">=</span> <span class="p">[</span><span class="s">'imdb_score'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">,</span>
               <span class="s">'aspect_ratio'</span><span class="p">,</span> <span class="s">'facenumber_in_poster'</span><span class="p">]</span>
<span class="n">new_col_order</span> <span class="o">=</span> <span class="n">cat_core</span> <span class="o">+</span> <span class="n">cat_people</span> <span class="o">+</span> \
                <span class="n">cat_other</span> <span class="o">+</span> <span class="n">cont_fb</span> <span class="o">+</span> \
                <span class="n">cont_finance</span> <span class="o">+</span> <span class="n">cont_num_reviews</span> <span class="o">+</span> \
                <span class="n">cont_other</span>
<span class="nb">set</span><span class="p">(</span><span class="n">movies</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_col_order</span><span class="p">)</span>
<span class="n">movies</span><span class="p">[</span><span class="n">new_col_order</span><span class="p">].</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p>새로운 열 순서를 담은 리스트가 원래 열을 모두 포함하도록 보장해야 한다. <br>
해들리 위컴은 먼저 고정 변수를 배치한 다음 측정 변수를 배치할 것을 제안했다.</p>

<h2 id="데이터프레임-요약">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%9A%94%EC%95%BD" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터프레임 요약</h2>
<p>단일 열이나 시리즈 데이터를 대상으로 작동하는 다양한 메서가 있었다.<br>
그중 다수는 단일 스칼라 값을 반환하는 집계 혹은 축약 메서드였다.<br>
데이터프레임에서 이와 동일한 메서드를 호출하면 각 열에 대해 해당 작업을 한꺼번에 수행하고 데이터프레임의 각 열에 대한 결과를 축약한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">shape</span>
<span class="n">movies</span><span class="p">.</span><span class="n">size</span>
<span class="n">movies</span><span class="p">.</span><span class="n">ndim</span>
<span class="nb">len</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="nb">min</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="n">describe</span><span class="p">().</span><span class="n">T</span>
<span class="n">movies</span><span class="p">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[.</span><span class="mi">01</span><span class="p">,</span> <span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="mi">99</span><span class="p">]).</span><span class="n">T</span>
</code></pre></div></div>
<p>.shape 속성은 행과 열 수를 가진 튜플을 반환한다.<br>
.size 속성은 데이터프레임의 총 원소 개수를 반환하는데 행과 열 개수의 곱이다.<br>
.ndim 속성은 차원수를 반환하는데 모든 데이터프레임은 2이다.<br>
.count() 메서드는 각 열에서 결측치가 아닌 데이터 개수를 보여준다.<br>
이는 각 열을 하나의 단일값으로 요약하므로 집계 메서드다.<br>
출력은 열 이름을 인덱스로 갖는 시리즈다.<br>
요약 통계량을 계산하는 메서드들은 수치 열의 열 이름을 인덱스로 하고 각 집계치를 값으로 갖는 시리즈를 반환한다.<br>
.describe() 메서드는 기술통계량과 분위수를 동시에 계산한다.<br>
이 메서드는 수치 열의 요약 통계량을 표시한다.<br>
.T를 사용해 결과를 전치시키면 화면에 더 많은 정보를 표시할 수 있다.<br>
percentiles 매개변수를 사용하면 .describe() 메서드에 정확한 분위수를 지정할 수 있다.<br>
판다스 기본설정에서 숫자 열에서 누락된 값은 건너뛰고 처리한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>
<p>skipna 매개변수를 False로 설정하면 적어도 하나의 결측치가 존재하는 경우 판다스는 모든 집계 메서드에서 NaN을 반환한다.</p>

<h2 id="데이터프레임-메서드-체인">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%B2%B4%EC%9D%B8" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터프레임 메서드 체인</h2>
<p>메서드 체인의 가장 핵심은 체인의 각 단계에서 반환되는 정확한 객체를 아는 것이다. <br>
판다스에서는 거의 항상 데이터프레임이나 시리즈 또는 스칼라 값이다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/movie.csv'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">shorten</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">col</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'facebook_likes'</span><span class="p">,</span> <span class="s">'fb'</span><span class="p">)</span>
               <span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'_for_reviews'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">shorten</span><span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="n">head</span><span class="p">()</span>
<span class="p">(</span><span class="n">movies</span>
   <span class="p">.</span><span class="n">isnull</span><span class="p">()</span>
   <span class="p">.</span><span class="nb">sum</span><span class="p">()</span>
   <span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">movies</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">movies</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">any</span><span class="p">().</span><span class="nb">any</span><span class="p">()</span>
</code></pre></div></div>
<p>전체 결측치의 개수를 스칼라 값으로 확인하고 싶으면 .isnull().sum().sum()<br>
데이터프레임에 결측치가 있는지 확인하려면 .isnull().any().any()<br>
object 데이터 형식이며 결측치를 가진 열은 집계 메서드(.min(), .max(), .sum())로부터 아무것도 반환하지 못한다.<br>
따라서 결측치를 채워야 한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">pd</span><span class="p">.</span><span class="n">option_context</span><span class="p">(</span><span class="s">'max_colwidth'</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
    <span class="n">movies</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s">'object'</span><span class="p">]).</span><span class="n">fillna</span><span class="p">(</span><span class="s">''</span><span class="p">).</span><span class="nb">max</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="데이터프레임-연산">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%97%B0%EC%82%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터프레임 연산</h2>
<p>판다스는 뱅커 반올림 연산을 한다. 즉 숫자가 양쪽의 한 가운데 있을 경우 가까운 짝수 쪽으로 만들어 버린다.<br>
소수 두 자리수로 반올림할 때 이 시리즈의 UGDS_BLACK 행이 어떻게 되는지 살펴보자.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colleges</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/college.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'INSTNM'</span><span class="p">)</span>
<span class="n">college_ugds</span> <span class="o">=</span> <span class="n">colleges</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s">'UGDS_'</span><span class="p">)</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">'Northwest-Shoals Community College'</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">college_ugds</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="p">.</span><span class="mi">0001</span><span class="p">).</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">college_ugds</span> <span class="o">+</span> <span class="p">.</span><span class="mi">00501</span>
<span class="p">(</span><span class="n">college_ugds</span> <span class="o">+</span> <span class="p">.</span><span class="mi">00501</span><span class="p">)</span> <span class="o">//</span> <span class="p">.</span><span class="mi">01</span>
<span class="n">college_ugds_op_round</span> <span class="o">=</span> <span class="p">(</span><span class="n">college_ugds</span> <span class="o">+</span> <span class="p">.</span><span class="mi">00501</span><span class="p">)</span> <span class="o">//</span> <span class="p">.</span><span class="mi">01</span> <span class="o">/</span> <span class="mi">100</span>
<span class="n">college_ugds_op_round</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">college_ugds_round</span> <span class="o">=</span> <span class="p">(</span><span class="n">college_ugds</span> <span class="o">+</span> <span class="p">.</span><span class="mi">00001</span><span class="p">).</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">college_ugds_round</span>
<span class="n">college_ugds_op_round</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">college_ugds_round</span><span class="p">)</span>
</code></pre></div></div>
<p>판다스가 뱅커 반올림하기 전에 .0001을 더하면 반올림된다. 
소수 2번째 자리까지 나타내려고 할 때 수학적으로 .005를 더하면 다음 단계의 정수 나눗셈이 가장 가까운 정수 백분율로 반올림되게 하는 데 충분하다.<br>
그러나 부동소수점의 부정확성으로 인해 문제가 발생한다.<br>
부동소수점 표현의 첫 번째 4자리 숫자가 실제 값과 동일하게 각 숫자에 .00001이 더하면 된다.<br>
해당 데이터셋에서 모든 점의 최대 정밀도가 소수점 이하 네 자리이기 때문이다. 
뱅커 반올림은 숫자가 지속적으로 더 높은 쪽으로 치우치는 것을 막아준다. <br>
.equals() 메서드는 두 데이터프레임 사이의 모든 요소와 인덱스가 정확히 동일한지 여부를 판별하고 불리언을 반환한다. <br>
결론은 소수점을 반올림 하고 싶으면 최대 정밀도보다 하나 더 큰 정밀도로 소수를 더해줘서 round 메서드를 사용하면 된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">college2</span> <span class="o">=</span> <span class="p">(</span><span class="n">college_ugds</span>
    <span class="p">.</span><span class="n">add</span><span class="p">(.</span><span class="mi">00501</span><span class="p">)</span> 
    <span class="p">.</span><span class="n">floordiv</span><span class="p">(.</span><span class="mi">01</span><span class="p">)</span> 
    <span class="p">.</span><span class="n">div</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">college2</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">college_ugds_op_round</span><span class="p">)</span>
</code></pre></div></div>
<p>시리즈와 마찬가지로 데이터프레임에도 연산자와 동등한 메서드가 있다.</p>

<h2 id="결측치-비교">
<a class="anchor" href="#%EA%B2%B0%EC%B8%A1%EC%B9%98-%EB%B9%84%EA%B5%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>결측치 비교</h2>
<p>판다스는 np.nan 객체를 사용해 결측치를 나타낸다. 이 객체는 자신과 같지 않다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="n">nan</span> <span class="o">==</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span> <span class="c1"># False
</span></code></pre></div></div>
<p>시리즈와 데이터프레임은 요소별 비교를 위해 ‘같음’ 연산자 ==를 사용한다.<br>
결과는 동일한 차원의 객체다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">college</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/college.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'INSTNM'</span><span class="p">)</span>
<span class="n">college_ugds</span> <span class="o">=</span> <span class="n">college</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s">'UGDS_'</span><span class="p">)</span>
<span class="n">college_ugds</span> <span class="o">==</span> <span class="p">.</span><span class="mi">0019</span>
<span class="n">college_self_compare</span> <span class="o">=</span> <span class="n">college_ugds</span> <span class="o">==</span> <span class="n">college_ugds</span>
<span class="n">college_self_compare</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">college_self_compare</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>
<span class="p">(</span><span class="n">college_ugds</span> <span class="o">==</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">college_ugds</span><span class="p">)</span>
</code></pre></div></div>
<p>등호 연산자는 결측치가 있는 데이터프레임과 비교할 때 문제가 된다.<br>
자기 자신을 등호를 사용해 연산하면 .all() 메서드를 사용한 결과에 모두 True가 있을 것 같지만 결과는 전혀 다르다.<br>
이 문제는 결측치가 서로 같은 것으로 여겨지지 않기 때문이다.<br>
등호 연산자를 사용해 결측치를 ‘같음’ 연산자를 사용해 세고 불리언 열을 합산하려고 하면 각각에 대해 0을 얻게 된다.<br>
이 또한 당연한 결과다.<br>
따라서 결측치 수를 얻는 데 등호 연산자가 아닌 .isna() 메서드를 사용하라. <br>
두 개의 전체 데이터프레임을 서로 비교하는 올바른 방법은 등호 연산자가 아니라 .equals() 메서드를 사용하는 것이다.<br>
이 메서드는 같은 위치에 있는 NaN을 동일하게 취급한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">college_ugds</span><span class="p">.</span><span class="n">eq</span><span class="p">(.</span><span class="mi">0019</span><span class="p">)</span>    <span class="c1"># same as college_ugds == .0019
</span><span class="kn">from</span> <span class="nn">pandas.testing</span> <span class="kn">import</span> <span class="n">assert_frame_equal</span>
<span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">college_ugds</span><span class="p">,</span> <span class="n">college_ugds</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span>
</code></pre></div></div>
<p>.eq() 메서드는 == 연산자와 마찬가지로 요소별 비교를 수행한다.<br>
.eq() 메서드는 .equals() 메서드와 전혀 다르다.<br>
pandas.testing 서브패키지 안에는 개발자들이 단위 테스트를 생성할 때 사용해야 하는 함수가 있다.<br>
asert_frame_equal 함수는 두 개의 데이터프레임이 같이 않으면 AssertionError를 발생시킨다.<br>
만약 같은 경우 None을 반환한다.</p>

<h2 id="데이터프레임-연산-방향-전환">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%97%B0%EC%82%B0-%EB%B0%A9%ED%96%A5-%EC%A0%84%ED%99%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터프레임 연산 방향 전환</h2>
<p>많은 데이터프레임 메서드에는 axis 매개변수가 있다. 이 매개변수는 연산이 진행되는 방향을 제어한다.<br>
axis 매개변수는 ‘index’(또는 0) 또는 ‘columns’(또는 1)이다.<br>
거의 모든 데이터프레임 메서드는 기본적으로 axis 매개변수를 0으로 설정하며 인덱스를 따르는 작업에 적용된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">college</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/college.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'INSTNM'</span><span class="p">)</span>
<span class="n">college_ugds</span> <span class="o">=</span> <span class="n">college</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s">'UGDS_'</span><span class="p">)</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'columns'</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'columns'</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">median</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span>

<span class="n">college_ugds_cumsum</span> <span class="o">=</span> <span class="n">college_ugds</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">college_ugds_cumsum</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p>UGDS로 시작하는 열은 특정 인종의 학부생 비율을 나타낸다. .filter() 메서드를 사용해 이 열들을 선택한다.<br>
.count() 메서드는 결측치가 아닌 개수를 반환한다.<br>
axis 매개변수를 ‘columns’로 변경하면 연산의 방향이 변경된다.<br>
결측치를 계산하는 대신 각 행의 모든 값을 합할 수 있다. 이 때 각 백분율 행은 합산이 1이 되어야 한다. .sum() 메서드를 사용해 확인할 수 있다.<br>
각 열의 분포를 알아보려면 .median() 메서드를 사용할 수 있다.<br>
.cumsum() 메서드는 누적합을 보여준다.</p>

<h2 id="대학-인종-다양성-지수-결정">
<a class="anchor" href="#%EB%8C%80%ED%95%99-%EC%9D%B8%EC%A2%85-%EB%8B%A4%EC%96%91%EC%84%B1-%EC%A7%80%EC%88%98-%EA%B2%B0%EC%A0%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>대학 인종 다양성 지수 결정</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">college</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/college.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'INSTNM'</span><span class="p">)</span>
<span class="n">college_ugds</span> <span class="o">=</span> <span class="n">college</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s">'UGDS_'</span><span class="p">)</span>
<span class="p">(</span><span class="n">college_ugds</span><span class="p">.</span><span class="n">isnull</span><span class="p">()</span>
   <span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'columns'</span><span class="p">)</span>
   <span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
   <span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">college_ugds</span> <span class="o">=</span> <span class="n">college_ugds</span><span class="p">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s">'all'</span><span class="p">)</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">ge</span><span class="p">(.</span><span class="mi">15</span><span class="p">)</span>
<span class="n">diversity_metric</span> <span class="o">=</span> <span class="n">college_ugds</span><span class="p">.</span><span class="n">ge</span><span class="p">(.</span><span class="mi">15</span><span class="p">).</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'columns'</span><span class="p">)</span>
<span class="n">diversity_metric</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">diversity_metric</span><span class="p">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">diversity_metric</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">college_ugds</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="s">'Regency Beauty Institute-Austin'</span><span class="p">,</span>
                   <span class="s">'Central Texas Beauty College-Temple'</span><span class="p">]]</span>
<span class="n">us_news_top</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Rutgers University-Newark'</span><span class="p">,</span>
                  <span class="s">'Andrews University'</span><span class="p">,</span>
                  <span class="s">'Stanford University'</span><span class="p">,</span>
                  <span class="s">'University of Houston'</span><span class="p">,</span>
                  <span class="s">'University of Nevada-Las Vegas'</span><span class="p">]</span>
<span class="n">diversity_metric</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">us_news_top</span><span class="p">]</span>

<span class="p">(</span><span class="n">college_ugds</span>
   <span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
   <span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
   <span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">college_ugds</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">01</span><span class="p">).</span><span class="nb">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nb">any</span><span class="p">()</span>
</code></pre></div></div>
<p>많은 대학에서 인종 열에 결측치가 있다. 모든 열에 대해 결측치 개수를 파악하고 결과 시리즈를 내림차순으로 정렬한다.<br>
.dropna() 메서드를 사용해 9개 인종 모두에 대한 값이 누락된 전체 행을 제거한다.<br>
‘크거나 같다’의 데이터프레임 메서드인 .ge()를 사용해 각 셀에 대한 불리언 값을 가진 데이터프레임을 구한다.<br>
.sum() 메서드를 사용해 각 대학의 True 값을 알아본다. 그리고 .value_counts() 메서드를 통해 분포를 파악한다.<br>
두 학교가 5가지 인종 범주에 대해 15% 이상의 학생을 갖고 있다.<br>
해당 학교를 .loc 인덱스로 선택해보자.<br>
범주를 알 수 없는 둘 이상의 인종 열이 집계되었다.  <br>
.dropna() 메서드에는 how라는 매개변수가 있으며 기본 설정 값은 문자열 ‘any’이지만 ‘all’로 변경할 수 있다.<br>
‘any’로 설정하면 하나 이상의 결측치가 포함된 행이 삭제된다.<br>
‘all’로 설정하면 모든 값이 누락된 행만 삭제된다.<br>
가장 다양화되지 않은 학교도 착을 수 있다.<br>
그리고 9개 범주 모두가 1%를 넘는 학교도 알아볼 수 있다.</p>

<h1 id="3장-데이터프레임-생성과-유지">
<a class="anchor" href="#3%EC%9E%A5-%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%83%9D%EC%84%B1%EA%B3%BC-%EC%9C%A0%EC%A7%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>3장 데이터프레임 생성과 유지</h1>
<h2 id="스크래치에서-데이터프레임-생성">
<a class="anchor" href="#%EC%8A%A4%ED%81%AC%EB%9E%98%EC%B9%98%EC%97%90%EC%84%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>스크래치에서 데이터프레임 생성</h2>
<p>’'’python
fname = [‘Paul’, ‘John’, ‘Richard’, ‘George’]
lname = [‘McCartney’, ‘Lennon’, ‘Starkey’, ‘Harrison’]
birth = [1942, 1940, 1940, 1943]
people = {‘first’: fname, ‘last’: lname, ‘birth’: birth}
beatles = pd.DataFrame(people)
beatles</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>데이터를 담은 병렬 리스트를 생성한다. 리스트 각각은 데이터프레임의 열이 되므로 동일한 데이터 타입을 가져야 한다.  
다음에 딕셔너리를 생성하고 열 이름을 리스트와 매핑한다.  
딕셔너리를 데이터프레임으로 만든다.  

```python
beatles.index
pd.DataFrame(people, index=['a', 'b', 'c', 'd'])

pd.DataFrame(
[{"first":"Paul","last":"McCartney", "birth":1942},
 {"first":"John","last":"Lennon", "birth":1940},
 {"first":"Richard","last":"Starkey", "birth":1940},
 {"first":"George","last":"Harrison", "birth":1943}])

 pd.DataFrame(
     [{"first":"Paul","last":"McCartney", "birth":1942},
 {"first":"John","last":"Lennon", "birth":1940},
 {"first":"Richard","last":"Starkey", "birth":1940},
 {"first":"George","last":"Harrison", "birth":1943}],
 columns=['last', 'first', 'birth'])
</code></pre></div></div>
<p>기본 설정으로 판다스는 데이터프레임의 생성자가 호출되면 RangeIndex를 생성한다. <br>
원한다면 데이터프레임에 다른 인덱스를 지정할 수도 있다.<br>
그리고 딕셔너리 여러 개를 담은 리스트로도 데이터프레임을 만들 수 있다.<br>
필요하면 columns 매개변수를 사용해 열 순서를 지정할 수 있다.</p>

<h2 id="csv-작성">
<a class="anchor" href="#csv-%EC%9E%91%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>CSV 작성</h2>
<p>CSV의 장점은 다음과 같다.</p>
<ul>
  <li>사람이 읽을 수 있다.</li>
  <li>텍스트 편집기에서 열린다.</li>
  <li>대부분의 소프트웨어 스프레드시트에서 읽을 수 있다.
CSV의 단점은 다음과 같다.</li>
  <li>CSV 표준이 없어 인코딩이 이상해보일 수 있다.</li>
  <li>형식을 지정할 수 없다.</li>
  <li>텍스트 기반이라 용량이 매우 커질 수 있다(물론 압축 가능하다).
데이터프레임에는 to_로 시작하는 몇 개의 메서드가 있는데 이들은 데이터프레임을 export 한다.
    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="n">fout</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">beatles</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span>  <span class="c1"># use a filename instead of fout
</span><span class="k">print</span><span class="p">(</span><span class="n">fout</span><span class="p">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>.to_csv() 메서드에는 몇 가지 옵션이 있다.<br>
index_col 매개변수가 있어 인덱스의 위치를 지정할 수 있다.<br>
또한 인덱스를 포함하고 싶지 않다면 index 매개변수를 False로 설정할 수 있다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span> <span class="o">=</span> <span class="n">fout</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">fout</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fout</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">beatles</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">fout</span><span class="p">.</span><span class="n">getvalue</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="대형-csv-파일-읽기">
<a class="anchor" href="#%EB%8C%80%ED%98%95-csv-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>대형 CSV 파일 읽기</h2>
<p>판다스 라이브러리는 인메모리 도구다. 판다스로 데이터를 다루려면 먼저 모두 메모리로 읽어야 한다.<br>
대규모 CSV 파일이라면 몇 가지 옵션이 있다.<br>
한 번에 일부만 처리할 수 있다면 부분만 읽은 다음 각 부분을 처리하면 된다.<br>
다른 방법은 파일 크기를 축소시키는 힌트를 사용하는 것이다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">diamonds</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/diamonds.csv'</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">diamonds</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">diamonds2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/diamonds.csv'</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'carat'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'depth'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'table'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'x'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'y'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'z'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'price'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">})</span>
<span class="n">diamonds2</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">diamonds</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">diamonds2</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">diamonds2</span><span class="p">.</span><span class="n">cut</span><span class="p">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">diamonds2</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">diamonds2</span><span class="p">.</span><span class="n">clarity</span><span class="p">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">diamonds3</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/diamonds.csv'</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'carat'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'depth'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'table'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'x'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'y'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'z'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'price'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">,</span>
           <span class="s">'cut'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'color'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">,</span>
           <span class="s">'clarity'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">})</span>
<span class="n">diamonds3</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">np</span><span class="p">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int8</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float16</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'carat'</span><span class="p">,</span> <span class="s">'cut'</span><span class="p">,</span> <span class="s">'color'</span><span class="p">,</span> <span class="s">'clarity'</span><span class="p">,</span> <span class="s">'depth'</span><span class="p">,</span> <span class="s">'table'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">]</span>
<span class="n">diamonds4</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/diamonds.csv'</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'carat'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'depth'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'table'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'price'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">,</span>
           <span class="s">'cut'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'color'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">,</span>
           <span class="s">'clarity'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">},</span>
    <span class="n">usecols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">diamonds4</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'carat'</span><span class="p">,</span> <span class="s">'cut'</span><span class="p">,</span> <span class="s">'color'</span><span class="p">,</span> <span class="s">'clarity'</span><span class="p">,</span> <span class="s">'depth'</span><span class="p">,</span> <span class="s">'table'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">]</span>
<span class="n">diamonds_iter</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/diamonds.csv'</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'carat'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'depth'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span>
           <span class="s">'table'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">,</span> <span class="s">'price'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">,</span>
           <span class="s">'cut'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'color'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">,</span>
           <span class="s">'clarity'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">},</span>
    <span class="n">usecols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">f'processed </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="n">size</span><span class="si">}</span><span class="s"> items'</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">diamonds_iter</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">process</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
</code></pre></div></div>
<p>nrows 매개변수를 사용하면 읽을 데이터를 작은 표본으로 제한할 수 있다.<br>
.info() 메서드를 사용해 데이터 표본이 사용하고 있는 메모리 용량을 알 수 있다.<br>
read_csv에 dtype 매개변수를 사용해 정확한(또는 더 적은) 수치 형식을 사용하도록 지정하자.<br>
수치형식을 변경하지 메모리 절약이 가능해졌다.<br>
dtype 매개변수를 사용해 객체 형식을 범주형으로 변경해보자. 먼저 각 object열의 .value_counts() 메서드를 살펴보자.<br>
개수가 몇 개 없다면 범주형으로 변경해 메모리를 더 절약할 수 있다.<br>
무시해도 되는 열은 usecols 매개변수를 사용해 제외해보자.<br>
위 단계들을 거쳤는데도 여전히 메모리가 부족한가? 만약 한 번에 전체 데이터를 메모리에 읽어들이지 않고 일부만 처리해도 된다면 chuncksize 매개변수를 쓰자.<br>
CSV 파일에는 데이터 형식에 대한 정보가 없으므로 판다스가 유추한다.<br>
열의 모든 값이 정수고 결측치가 없다면 int64를 사용한다.<br>
열이 수치지만 정수가 아닌 경우 또는 결측치가 있다면 float64를 사용한다.<br>
열이 수치가 아니면 판다스는 열을 object 열로 변환하고 값을 문자열로 취급한다.<br>
판다스의 문자열 값은 각각 파이썬 문자열로 저장되므로 많은 메모리를 차지한다.<br>
이를 범주형으로 변환하면 메모리를 절약할 수 있다.<br>
또한 read_csv() 함수에 URL을 직접 전달하여 인터넷상의 CSV 파일을 읽을 수 있다.<br>
iinfo() 함수를 사용하면 넘파이 integer 형식의 범위를 볼 수 있으며 finfo() 함수로 부동소수점 형식의 정보를 볼 수 있다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">diamonds</span><span class="p">.</span><span class="n">price</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">()</span>
<span class="n">diamonds</span><span class="p">.</span><span class="n">price</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">diamonds</span><span class="p">.</span><span class="n">cut</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">()</span>
<span class="n">diamonds</span><span class="p">.</span><span class="n">cut</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">diamonds4</span><span class="p">.</span><span class="n">to_feather</span><span class="p">(</span><span class="s">'/tmp/d.arr'</span><span class="p">)</span>
<span class="n">diamonds5</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s">'/tmp/d.arr'</span><span class="p">)</span>
<span class="n">diamonds4</span><span class="p">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s">'/tmp/d.pqt'</span><span class="p">)</span>
</code></pre></div></div>

<p>.memory_usage() 메서드를 사용하면 메모리 사용량을 알 수 있으며 deep=True를 전달하면 객체 형식 시리즈의 사용량을 알 수 있다.<br>
원하는 형식으로 데이터를 가져오면 Feather 형식과 같이 형식을 추적하는 이진형식으로 저장할 수 있다.<br>
판다스는 pyarrow 라이브러리를 사용해 수행한다.<br>
이 형식은 언어 간에 구조화된 데이터를 메모리 내에서 전송할 수 있게 하기 위한 것이다.<br>
내부 변환 없이 데이터를 그대로 사용할 수 있도록 최적화됐다.<br>
이 형식으로 일단 정의하고 나면 훨씬 빠르게 쉽게 읽어들일 수 있다.<br>
또 다른 이진 옵션으로는 Parquet 형식이 있다.<br>
Feather가 인메모리 구조의 이진 데이터를 최적화하는 반면 Parquet은 온디스크 형식을 최적화한다.<br>
둘 다 CSV보다 빠르며 형식을 유지한다.</p>

<h2 id="엑셀-파일-사용">
<a class="anchor" href="#%EC%97%91%EC%85%80-%ED%8C%8C%EC%9D%BC-%EC%82%AC%EC%9A%A9" aria-hidden="true"><span class="octicon octicon-link"></span></a>엑셀 파일 사용</h2>
<p>엑셀 파일로 읽고 저장하려면 xlwt 또는 openpyxl을 설치해야 한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">beatles</span><span class="p">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s">'/tmp/beat.xls'</span><span class="p">)</span> <span class="c1"># 더이상 지원 안함
</span><span class="n">beatles</span><span class="p">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s">'/tmp/beat.xlsx'</span><span class="p">)</span>
<span class="n">beat2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">'/tmp/beat.xls'</span><span class="p">)</span>
<span class="n">beat2</span>
<span class="n">beat2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">'/tmp/beat.xls'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">beat2</span>
<span class="n">beat2</span><span class="p">.</span><span class="n">dtypes</span>
</code></pre></div></div>
<p>xlwt는 앞으로 더 이상 사용되지 않을 예정이다. 따라서 openpyxl 라이브러리를 다운 받고 ‘~.xlsx’ 로 저장해야 한다.<br>
xlrd도 마찬가지로 사용하지 말자. openpyxl은 .xlsx 파일을 읽고 쓸 수 있는 라이브러리다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xl_writer</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s">'/tmp/beat.xlsx'</span><span class="p">)</span>
<span class="n">beatles</span><span class="p">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl_writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s">'All'</span><span class="p">)</span>
<span class="n">beatles</span><span class="p">[</span><span class="n">beatles</span><span class="p">.</span><span class="n">birth</span> <span class="o">&lt;</span> <span class="mi">1941</span><span class="p">].</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl_writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s">'1940'</span><span class="p">)</span>
<span class="n">xl_writer</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></div>
<p>.to_excel() 메서드에 sheet_name 매개변수를 전달하면서 시트의 이름을 지정할 수 있다.</p>

<h2 id="zip-파일로-작업">
<a class="anchor" href="#zip-%ED%8C%8C%EC%9D%BC%EB%A1%9C-%EC%9E%91%EC%97%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>ZIP 파일로 작업</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">autos</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"data/vehicles.csv.zip"</span><span class="p">)</span>
<span class="n">autos</span><span class="p">[</span><span class="s">'modifiedOn'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">auto</span><span class="p">[</span><span class="s">'modifiedOn'</span><span class="p">])</span>
<span class="n">autos</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/vehicles.csv.zip'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s">'modifiedOn'</span><span class="p">])</span>
</code></pre></div></div>
<p>zip 파일에 csv파일 하나만 있다면 바로 읽을 수 있다. <br>
오브젝트 타입을 날짜 타입으로 변환하는 데 2가지 방법이 있다. 하나는 pd.to_datetime() 메서드를 사용하는 것이다.<br>
다른 하나는 parse_dates 인자에 컬럼 값을 리스트에 넣어서 csv파일을 읽는 것이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">zipfile</span>

<span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">(</span>
    <span class="s">'data/kaggle-survey-2018.zip'</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">namelist</span><span class="p">()))</span>
    <span class="n">kag</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">z</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'multipleChoiceResponses.csv'</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">kag_questions</span> <span class="o">=</span> <span class="n">kag</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">survey</span> <span class="o">=</span> <span class="n">kag</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</code></pre></div></div>
<p>read_csv 함수는 ZIP 파일 내부의 파일을 지정할 수 있는 기능이 없다.<br>
대신 파이썬 표준 라이브러리에 있는 zipfile 모듈을 사용해야 한다. <br>
zipfile 모듈은 URL과는 작동하지 않는다. 따라서 ZIP 파일이 URL에 있으면 먼저 다운로드해야 한다.</p>

<h2 id="데이터베이스와-작업">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EC%99%80-%EC%9E%91%EC%97%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터베이스와 작업</h2>
<p>데이터를 저장하기 위한 SQLite 데이터베이스를 생성한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"d:/data/beat.db"</span><span class="p">)</span>

<span class="k">with</span> <span class="n">con</span><span class="p">:</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"""DROP TABLE band"""</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"""CREATE TABLE Band(
        id INTEGER PRIMARY KEY,
        fname TEXT,
        lname TEXT,
        birthyear INT
    )"""</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"""INSERT INTO Band VALUES(0, 'Paul', 'McCartney', 1942)"""</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"""INSERT INTO Band VALUES(1, 'John', 'Lennon', 1940)"""</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div></div>
<p>이제 데이터베이스에서 테이블을 DataFrame으로 읽어본다.<br>
테이블을 읽으려면 SQLAlchemy와 연결이 필요하다. 이 라이브러리는 데이터베이스를 추상화한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="n">sa</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s">"sqlite:///data/beat.db"</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">sa_connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">beat</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span>
    <span class="s">"Band"</span><span class="p">,</span> <span class="n">sa_connection</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'id'</span>
<span class="p">)</span>

<span class="n">sql</span> <span class="o">=</span> <span class="s">"""SELECT fname, birthyear from Band"""</span>
<span class="n">fnames</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
</code></pre></div></div>
<p>판다스 라이브러리는 SQLAlchemy 라이브러리를 활용하는데 대부분의 SQL 데이터베이스와 소통할 수 있다.</p>

<h2 id="json-파일-읽기">
<a class="anchor" href="#json-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>JSON 파일 읽기</h2>
<p>파이썬 표준 라이브러리에는 JSON에서 인코딩과 디코딩이 되는 json 라이브러리가 들어있다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>
<span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>

<span class="n">beatles</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
</code></pre></div></div>
<p>read_json() 함수를 이용해 데이터를 읽는다. json 파일을 읽을 때 알아둬야 할 것은 판다스가 로드할 수 있는 특정 형식이어야 한다는 것이다.<br>
판다스는 몇 가지 데이터 방향을 지원한다.</p>
<ul>
  <li>columns : (기본설정) 열 이름과 열에 있는 값 리스트의 매핑이다.</li>
  <li>records : 행의 리스트로, 각 행은 열과 값을 매핑하는 딕셔너리다.</li>
  <li>split : columns를 열 이름에, index를 인덱스 값에, data를 각 데이터의 행 리스트에 매핑한다.</li>
  <li>index : 데이터에서 각 행의 리스트다. 열이나 인덱스 값을 포함하지 않는다.</li>
  <li>table : schema를 DataFrame 스키마에, data를 딕셔너리의 리스트에 연결한다.</li>
</ul>

<p>다음은 이러한 형식의 예이다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">records</span> <span class="o">=</span> <span class="n">beatles</span><span class="p">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">'records'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'records'</span><span class="p">)</span>

<span class="n">split</span> <span class="o">=</span> <span class="n">beatles</span><span class="p">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">'split'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'split'</span><span class="p">)</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">beatles</span><span class="p">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span>

<span class="n">values</span> <span class="o">=</span> <span class="n">beatles</span><span class="p">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">'values'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'values'</span><span class="p">).</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">([</span><span class="s">'first'</span><span class="p">,</span> <span class="s">'last'</span><span class="p">,</span> <span class="s">'birth'</span><span class="p">])))</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">beatles</span><span class="p">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">'table'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'table'</span><span class="p">)</span>
</code></pre></div></div>
<p>JSON을 생성해야 하는 경우(웹 서비스 작성 등)라면 columns나 records 방향을 권장한다. 
만약 JSON에 데이터를 추가해야 하는 경우라면 .to_dict() 메서드를 사용해 딕셔너리를 생성하라.<br>
새 데이터를 딕셔너리에 추가한 다음 해당 딕셔너리를 JSON으로 변환할 수 있다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output</span> <span class="o">=</span> <span class="n">beat</span><span class="p">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">output</span><span class="p">[</span><span class="s">'version'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'0.4.1'</span>
<span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="html-테이블-읽기">
<a class="anchor" href="#html-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%9D%BD%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>HTML 테이블 읽기</h2>

<h1 id="데이터-분석-시작">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D-%EC%8B%9C%EC%9E%91" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터 분석 시작</h1>
<h2 id="데이터-분석-루틴-개발">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D-%EB%A3%A8%ED%8B%B4-%EA%B0%9C%EB%B0%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터 분석 루틴 개발</h2>


  </div><a class="u-url" href="/dailyblog/markdown/database/dbms/mysql/datatype/2021/11/05/post020.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/dailyblog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/dailyblog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/dailyblog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Simple TIL trace</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/sangwon-woo" title="sangwon-woo"><svg class="svg-icon grey"><use xlink:href="/dailyblog/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
